{% extends "base.html" %}
{% block pagetitle %} Order: {{ order.id }} {% endblock %}

{% block content %}

<h2>Details for Order: {{ order.id }}</h2>
<span>
    <a href="{{ url_for('home') }}">Home</a> /
    <a href="{{ url_for('orders.view_orders') }}">Orders</a> /
    <a href="{{ url_for('orders.details', id=order.id)}}">{{ order.id }}</a>
</span>
<table>
    <!-- Headers -->
    <tr>
        <th>Id</th>
        <th>Items</th>
        <th>Quantity</th>
        <th>Est. Total</th>
    </tr>
    <!-- Data -->
     {% for item in order.items %}
    <tr>
        <td>{{ item.order_id }}</td>
        <td>
            <a href="{{ url_for('products.details', id=item.product.id) }}">
                {{ item.product.name.title() }}
            </a>
        </td>
        <td>{{ item.quantity }}</td>
        <td>${{ item.product.price * item.quantity }}</td>
    </tr>
    {% endfor %}
</table>

<!-- Customer Name -->
<p>
    <b>Ordered by: </b>
    <a href="{{ url_for('customers.details', id=order.customer.id) }}">
        {{ order.customer.name.title() }}
    </a>
</p>

<!-- Created -->
<p>
    <b>Created: </b> {{ order.created }}
</p>

<!-- Completed -->
<p>
    <b>Completed: </b> {{ order.completed }}
</p>

<!-- Total -->
<p><b>Total: </b> ${{ order.estimate() }}</p>

<!-- Actions -->
{% if not order.completed %}
    {% if order.can_complete() %}
        <form method="post" action="{{ url_for('orders.complete', id=order.id) }}">
            <button type="submit">Complete Order</button>
        </form>
    {% else %}
        <p class="critical">* Not enough stock to complete order</p>
        <button class="faded">Completed</button>
    {% endif%}
{% else %}
    <button class="faded">Completed</button>
{% endif %}

{% endblock %}